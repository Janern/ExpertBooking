@{
    ViewData["Title"] = "AnyShore | Book ekspert";
}
@model BusinessModels.Expert[]
@using (Html.BeginForm("Book", "BookExpert", FormMethod.Post))
{
    <div class="section">
        <div class="container">
            <div class="row form-row">
                <div class="four columns">
                    <label class="inputLabel" for="TimePeriod">Forventet periode:</label>
                    <input class="inputValue" type="text" name="TimePeriod" value=""/>
                </div>
                <div class="four columns">
                    <label class="inputLabel" for="ExpertRole">Rolle:</label>
                    <select class="inputValue u-full-width" name="ExpertRole" class="u-full-width">
                        <option value="">Alle</option>
                        <option value="leader">Prosjektleder</option>
                        <option value="senior">Senior</option>
                        <option value="junior">Junior</option>
                    </select>
                </div>
                <div class="four columns">
                    <label class="inputLabel" for="ExpertType">Teknologi:</label>
                    <select class="inputValue u-full-width" name="ExpertType" name="" class="u-full-width">
                        <option value="">Alle</option>
                        <option value=".net">.Net</option>
                        <option value="java">Java</option>
                        <option value="ux">UX</option>
                        <option value="tester">Tester</option>
                        <option value="python">Python</option>
                        <option value="frontend">Frontend</option>
                    </select>
                </div>
            </div>
            <div class="row form-row light-blue" id="expertTable">
                <!-- placeholder for json from controller -->
            </div>

            <input id="SelectedExpertsJsonInput" name="SelectedExpertsJson" type="hidden" value="" />
            <div class="row form-row">
                <div class="twelve columns full u-full-width">
                    <label for="Description">Beskriv prosjektet:</label>
                    <textarea class="u-full-width" type="text" name="Description" value=""></textarea>
                </div>
            </div>
            <div class="row form-row light-blue">
                <div class="four columns"></div>
                <div class="four columns">
                    <label for="BookerEmailAddress">Din Epostadresse:</label>
                    <input type="text" name="BookerEmailAddress" value="" />
                </div>
            </div>
            <div class="row form-row">
                <div class="twelve columns">
                    <input type="submit" class="button-primary" value="Bestill"/>
                </div>
            </div>
        </div>
    </div>
}
@section scripts {
    <script>
        $('input[name="TimePeriod"]').daterangepicker();
        let selectedExpertsJson = [];
        let availableExpertsJson = []; 
        const selectedExpertsJsonInput = document.getElementById("SelectedExpertsJsonInput");
        
        function fetchExperts() 
        {
            $.ajax({
                url: '/ListExperts/JsonData',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    availableExpertsJson = JSON.parse(data);
                    $('#expertTable').empty();
                    $.each(availableExpertsJson, function (index, expert) {
                        row = '<div id="'+expert.Id+'" class="three columns expertCard" onclick="ToggleExpertSelected(this, \''+expert.Id+'\')">';
                        row += '<div class="two columns">&nbsp;';
                        row += '</div>';
                        row += '<div class="eight columns">';
                        row += '<img src="images/'+expert.Id+'.jpg" class="expert-table-img u-max-full-width" />';
                        row += '<i class="selectedExpertCheckmark img-overlay-pick-expert-btn"></i>';
                        row += '</div>';
                        row += '<div class="two columns">&nbsp;';
                        row += '</div>';
                        row += '<div class="twelve columns">';
                        row += '<span class="expertLabel">Navn: </span>'+
                            '<span class="expertAttribute"> '+
                                expert.FirstName +' '+ expert.LastName +
                            '</span>';
                        row += '</div>';
                        row += '<div class="twelve columns">';
                        row += '<span class="expertLabel">Rolle: </span>'+
                            '<span class="expertAttribute"> '+
                                expert.Role +
                            '</span>';
                        row += '</div>';
                        row += '<div class="twelve columns">';
                        row += '<span class="expertLabel">Teknologi: </span>' +
                            '<span class="expertAttribute"> '+ expert.Technology +
                            '</span>'
                        row += '</div>';
                        row += '</div>';

                        $('#expertTable').append(row);
                    });
                },
                error: function () {
                    console.error('Error fetching JSON data.');
                }
            });
        };
        function ToggleExpertSelected(clickedElement, expertId){
            let indexOfExpert = selectedExpertsJson.findIndex(item => item.Id === expertId);
            if(indexOfExpert > -1){
                selectedExpertsJson = selectedExpertsJson.splice(indexOfExpert, 1);
            }else{
                let indexOfExpert = availableExpertsJson.findIndex(item => item.Id === expertId);
                if(indexOfExpert > -1)
                {
                    selectedExpertsJson.push(availableExpertsJson[indexOfExpert]);
                }
            }
            selectedExpertsJsonInput.value = JSON.stringify(selectedExpertsJson);
            clickedElement.classList.toggle("clicked");
        };
        $(document).ready(function() {
            availableExpertsJson = fetchExperts();
            $('#fetchDataButton').click(function () {
                availableExpertsJson = fetchExperts();
            });
        });
   </script>
}